<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
    <meta http-equiv="X-UA-Compatible" content="ie=edge"/>
    <title>{%block title%}{%endblock%}</title>

    {% block include_jquery %}
    <script src="https://code.jquery.com/jquery-3.4.1.min.js" crossorigin="anonymous"></script>
    {% endblock %}
    {% import "helpers/src_macros.html" as macro %}
    {{ macro.filehelper(notify_js=True) }}

    {% block before_head %}
    {% endblock %}
    <!-- CSS files -->
    <link href="{{ url_for('static', filename='css/margins.css') }}" rel="stylesheet"/>
    <link href="{{ url_for('static', filename='css/tabler.min.css') }}" rel="stylesheet"/>
    <link href="{{ url_for('static', filename='css/tabler-flags.min.css') }}" rel="stylesheet"/>
    <link href="{{ url_for('static', filename='css/tabler-payments.min.css') }}" rel="stylesheet"/>
    <link href="{{ url_for('static', filename='css/tabler-vendors.min.css') }}" rel="stylesheet"/>
    <link rel="stylesheet" href="https://unpkg.com/@tabler/icons@latest/iconfont/tabler-icons.min.css">

    {% block head %}
    <style>
    .sticky-toolbar {
      width: 46px;
      position: fixed;
      top: 30%;
      right: 0;
      list-style: none;
      margin: 0;
      z-index: 95;
      background: #ffffff;
      -webkit-box-shadow: 0px 0px 50px 0px rgb(82 63 105 / 15%);
      box-shadow: 0px 0px 50px 0px rgb(82 63 105 / 15%);
      display: -webkit-box;
      display: -ms-flexbox;
      display: flex;
      -webkit-box-pack: center;
      -ms-flex-pack: center;
      justify-content: center;
      -webkit-box-align: center;
      -ms-flex-align: center;
      align-items: center;
      -webkit-box-orient: vertical;
      -webkit-box-direction: normal;
      -ms-flex-direction: column;
      flex-direction: column;
      border-top-left-radius: 0.85rem;
      border-bottom-left-radius: 0.85rem;
    }
    </style>

    {% endblock %}
  </head>
  {%block body%}
  {%block toolbar%}
  <ul class="sticky-toolbar nav flex-column pl-2 pr-2 pt-3 pb-3 mt-4 bg-white">
    <!--begin::Item-->
    <li class="nav-item mb-3" id="kt_demo_panel_toggle" data-toggle="tooltip" title="" data-placement="right" data-original-title="Check out more demos">
      <a href="#" class="nav-link p-0" data-bs-toggle="dropdown" tabindex="-1" aria-label="Show notifications" aria-expanded="false">
        <i class="ti ti-settings text-warning icon"></i>
      </a>
      <div class="dropdown-menu dropdown-menu-end dropdown-menu-card">
        <a class="dropdown-item subheader" href="#">New Spark
          <span class="ms-auto"><i class="ti ti-settings"></i></span>
        </a>
        <a class="dropdown-item subheader" href="#">New Doc
          <span class="ms-auto"><i class="ti ti-settings"></i></span>
        </a>
        <a class="dropdown-item subheader" href="#">Quick Note
          <span class="ms-auto"><i class="ti ti-settings"></i></span>
        </a>
      </div>
    </li>
    <!--end::Item-->
    <!--begin::Item-->
    <li class="nav-item mb-3" id="kt_demo_panel_toggle" data-toggle="tooltip" title="" data-placement="right" data-original-title="Check out more demos">
        <a href="#" aria-label="Tabler" data-bs-toggle="modal" data-bs-target="#modal-spark-folder">
            <i class="ti ti-activity icon text-primary"></i>
        </a>
    </li>
    <!--end::Item-->
  </ul>
  {%endblock%}
  <body class="antialiased">
    <div class="wrapper">
      <header class="navbar navbar-expand-md navbar-dark navbar-overlap d-print-none">
        <div class="container-xl">
          <h1 class="navbar-brand navbar-brand-autodark">
            <a href="{{url_for('main.home')}}">
              <i class="ti bg-white p-1 ti-activity text-dark icon mr-2 rounded"></i>{{config["APP_NAME"]|capitalize}}
            </a>
          </h1>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar-menu">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="navbar-nav flex-row order-md-last">
            {%block navbar%}
            <div class="nav-item dropdown d-none d-md-flex me-3">
              <a href="#" class="nav-link px-0" data-bs-toggle="dropdown" tabindex="-1" aria-label="Show notifications">
                <!-- Download SVG icon from http://tabler-icons.io/i/bell -->
                <i class="ti ti-bell icon"></i>
                <span class="badge bg-red"></span>
              </a>
              <div class="dropdown-menu dropdown-menu-end dropdown-menu-card">
                <div class="card">
                  <div class="card-header justify-content-between">
                    <h5 class="card-title subheader"><a href="{{url_for('main.notifications')}}">Recent</a></h5>
                    <a href="{{url_for('main.notifications')}}"><span class="badge bg-red-lt badge-sm">2</span></a>
                  </div>
                  <div class="card-body">
                  {%for n in current_user.get_notifications(limit=7)%}
                    <a href="{{n.link}}"><p class="text-small h5 text-muted">{{n["title"]}}</p></a>
                    <div class="hr-text text-red m-3">{{n["date_added"]}}</div>
                  {%endfor%}
                  </div>
                </div>
              </div>
            </div>
            <div class="nav-item dropdown">
              <a href="#" class="nav-link d-flex lh-1 text-reset p-0" data-bs-toggle="dropdown" aria-label="Open user menu">
                {%if current_user.image_url%}<span class="avatar-sm avatar" style="background-image: url({{current_user.get_image_url()}})"></span>{%else%}<span class=" avatar avatar-sm "><i class="ti ti-user"></i></span>{%endif%}
                <div class="d-none d-xl-block ps-2">
                  <div class="small text-muted font-weight-bold">{{current_user.get_fullname() or current_user.username or current_user.email}}</div>
                  <div class="mt-1 small text-muted"></div>
                </div>
              </a>
              <div class="dropdown-menu dropdown-menu-end dropdown-menu-arrow">
                <a href="#" class="dropdown-item">Settings</a>
                <a href="{{url_for('auth.logout')}}" class="dropdown-item">Logout</a>
              </div>
            </div>
            {%endblock%}
          </div>
          <div class="collapse navbar-collapse" id="navbar-menu">
          </div>
        </div>
      </header>
      <div class="page-wrapper">
        <div class="container-xl">
          {%block contentHeader%}
          <!-- Page title -->
          <div class="page-header d-print-none">
            <div class="row align-items-center">
              <div class="col">
                <!-- Page pre-title -->
                <div class="page-pretitle">
                  {%block contentHeader_pretitle%}{%endblock%}
                </div>
                <h2 class="page-title text-white">
                  {%block contentHeader_title%}{%endblock%}
                </h2> 
              </div>
              {% block contentHeader_buttons%}{%endblock%}
            </div>
          </div>
          {%endblock%}
        </div>
        <div class="page-body">
          <div class="container-xl">
          {%block content%}
          {%endblock%}
          </div>
        </div>
        <footer class="footer footer-transparent d-print-none">
          <div class="container">
            <div class="row text-center align-items-center flex-row-reverse">
              <div class="col-lg-auto ms-lg-auto">
                <ul class="list-inline list-inline-dots mb-0">
                  <li class="list-inline-item"><a href="./docs/index.html" class="link-secondary">Documentation</a></li>
                  <li class="list-inline-item"><a href="./license.html" class="link-secondary">License</a></li>
                  <li class="list-inline-item">
                    <a href="https://github.com/sponsors/codecalm" target="_blank" class="link-secondary" rel="noopener">
                      <!-- Download SVG icon from http://tabler-icons.io/i/heart -->
                      <svg xmlns="http://www.w3.org/2000/svg" class="icon text-pink icon-filled icon-inline" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M19.5 13.572l-7.5 7.428l-7.5 -7.428m0 0a5 5 0 1 1 7.5 -6.566a5 5 0 1 1 7.5 6.572" /></svg>
                      Sponsor
                    </a>
                  </li>
                </ul>
              </div>
              <div class="col-12 col-lg-auto mt-3 mt-lg-0">
                <ul class="list-inline list-inline-dots mb-0">
                  <li class="list-inline-item">
                    Copyright &copy; 2021
                    <a href="." class="link-secondary">{{config["APP_NAME"]|capitalize}}</a>.
                    All rights reserved.
                  </li>
                  <li class="list-inline-item">
                    <a href="./changelog.html" class="link-secondary" rel="noopener">v1.0.0-beta3</a>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </footer>
      </div>
    </div>
    {%block modals%}
    {%endblock%}
    <div class="modal modal-blur fade" id="modal-spark-folder" tabindex="-1" role="dialog" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Saved Sparks</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="row mb-3 align-items-end">
              <p class="empty-subtitle text-muted">
                Saved sparks will populate below so you can access them quickly.
              </p>
            </div>
            <div class="col-12">
                <div class="card">
                  <div class="table-responsive">
                    <table class="table table-vcenter card-table">
                      <thead>
                        <tr>
                          <th>Spark</th>
                          <th class="w-1"></th>
                        </tr>
                      </thead>
                      <tbody id="saved-sparks-table">
                        <tr></tr>
                      </tbody>
                    </table>
                  </div>
                </div>
            </div>

          </div>
          <div class="modal-footer">
            <button type="button" class="btn me-auto subheader" data-bs-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
  </body>
  {%endblock%}

  <script>
    $('#modal-spark-folder').on('shown.bs.modal', function (e) {
        $.ajax({
          url:"/api/v1/users/{{current_user.id}}/saved-sparks",
          type: "GET",
          success:function(data) {
            $('#saved-sparks-table').html("<tr><tr>")
            $.each(data["sparks"],function(index,value){
              var spark_link = window.location.origin + "/sparks/"+value["id"];
              var tableRow = '<td class="text-muted"><a href="'+spark_link+'" class="text-reset">'+value["name"]+'</a></td><td><a href="#" onclick="unsaveSpark('+value["id"]+');">Unsave</a></td>';
              $('#saved-sparks-table tr:last').after('<tr>'+tableRow+'</tr>');
            });
          }
        });
    })
  </script>
  <!-- Libs JS -->
  <script src="{{ url_for('static', filename='js/apexcharts.min.js') }}"></script>
  <!-- Tabler Core -->
  <script src="{{ url_for('static', filename='js/tabler.min.js') }}"></script>
  <script>
  {% for category,message in get_flashed_messages(with_categories=True)[:3] %}
    {% if category == "message" %}
      {% set category = "primary" %}
    {% endif %}
    notify_js("{{message}}",type="{{category}}")
  {% endfor %}
  </script>

  {%block extrajs%}
  {%endblock%}
</html>
